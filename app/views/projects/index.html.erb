<h3 id="projects_list_title">项目列表</h3>
<table id="project_list_table">
  <thead>
    <tr>
      <td>项目名称 <small>(<%= link_to '新增项目', new_project_path %>)</small></td>
      <td>任务名称</td>
      <% td_width = 68 %>
      <% tn = 1 %>
      <% tdd_steps.each do |step| %>
        <% arrow = tn == tdd_steps.size ? '' : ' ➠' %>
        <td width="<%=td_width%>"><%= step %><%= arrow %></td>
        <% tn += 1 %>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% @projects.each do |project| %>
      <% if project.tasks_count > 0 %>
        <% project_name_flag = false %>
        <% n =1 %>
        <% project.uncomplete_tasks.order(is_top: :desc,tdd_step: :desc).each do |task| %>
          <tr valign="top">
            <% if !project_name_flag %>
              <td id="<%= dom_id(project) %>" class="name" valign="top" rowspan="<%= project.tasks_count %>"><%= link_to project.name, edit_project_path(project) %></td>
              <% project_name_flag = true %>
            <% end %>
              <td id="<%= dom_id(project) %>_task_<%=n%>"><%= top_ico(task.is_top) %><%= link_to task.name, edit_task_path(task) %></td>
              <% (1..task.tdd_step).each do %>
                <td align="center"><%= pass_png %></td>
              <% end %>
              <% (task.tdd_step+1..tdd_steps.size).each do |n| %>
                <td align="center"><%= link_to empty_png, {controller: :tasks, action: :update_tdd_step, id: task.id, new_step_num: n},{id: "task_#{task.id}_tdd_step_#{n}"} %></td>
              <% end %>
            </tr>
          <% n += 1 %>
        <% end %>
      <% else %>
        <tr>
          <td id="<%= dom_id(project) %>" class="name" colspan="5"><%= link_to project.name, edit_project_path(project) %></td>
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>
